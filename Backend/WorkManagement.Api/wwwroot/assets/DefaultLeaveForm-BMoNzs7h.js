import{r as u,ay as G,aC as P,bi as Q,aD as U,bj as _,bk as W,ab as v,j as s,a as i,F as q,T as K,t as I,I as w,S as F,M as C,aJ as S,y as V,B as p,x as X,w as Y,p as Z,e as ee}from"./index-Cf0SbAd0.js";function te(){const[l,y]=u.useState(null),[r,c]=u.useState([]),[j,L]=u.useState([]),[b,h]=u.useState(!1),d=G(),{data:n,isLoading:x}=P(),[J,{isLoading:z}]=Q(),[H,{isLoading:A}]=U(),[E,{isLoading:O}]=_(),{data:f,isLoading:B}=W();u.useEffect(()=>{if(n&&n.length>0&&!l){const e=n[0].id;y(e),D(e)}},[n]),u.useEffect(()=>{l&&!r.length&&D(l)},[l]);const D=async e=>{try{const t=(await H({jobLevelId:e}).unwrap()).map(o=>{var m;return{id:o.id,name:((m=o.employeeLeaveTypes)==null?void 0:m.name)||"",jobLevelLeaveTypeId:o.jobLevelLeaveId||0,totalLeaves:o.totalLeaves}});c(t),L(t)}catch(a){console.error("Error fetching default leaves:",a),d(v({message:"Failed to fetch default leaves",autoHideDuration:6e3,anchorOrigin:{vertical:"top",horizontal:"center"},variant:"error"}))}},R=e=>{if(b){d(v({message:"Please save your changes before switching job levels, or your updates will be lost.",autoHideDuration:6e3,anchorOrigin:{vertical:"top",horizontal:"center"},variant:"warning"}));return}const a=e.target.value;y(a),c([]),h(!1)},T=(e,a,t)=>{const o=[...r];o[e]={...o[e],[a]:t},c(o),h(!0)},g=(e,a)=>r.some((t,o)=>t.name===e&&o!==a),k=async e=>{const a=r[e];try{await E({id:a.id}).unwrap();const t=r.filter((o,m)=>m!==e);c(t),L(t),d(v({message:"Default leave removed successfully",autoHideDuration:6e3,anchorOrigin:{vertical:"top",horizontal:"center"},variant:"success"}))}catch(t){console.error("Error removing default leave:",t),d(v({message:"Failed to remove default leave",autoHideDuration:6e3,anchorOrigin:{vertical:"top",horizontal:"center"},variant:"error"}))}},M=()=>{l&&(c([...r,{id:0,name:"",jobLevelLeaveTypeId:l,totalLeaves:0}]),h(!0))},N=async()=>{if(l)try{if(await J({body:r}).unwrap())L(r),d(v({message:"Leave types updated successfully",autoHideDuration:6e3,anchorOrigin:{vertical:"top",horizontal:"center"},variant:"success"})),h(!1);else throw new Error("Failed to update leave types")}catch(e){console.error("Error updating leave types:",e),d(v({message:"Failed to update leave types",autoHideDuration:6e3,anchorOrigin:{vertical:"top",horizontal:"center"},variant:"error"}))}},$=()=>{l&&c([...j]),h(!1)};return x||z||A||O||B?s(ee,{}):s("div",{children:i(Z,{className:"flex flex-col flex-auto shadow-1 overflow-hidden rounded-xl w-full h-full p-10",elevation:0,children:[i("div",{className:"flex items-center border-b-1 space-x-8 m-10",children:[s(q,{color:"action",size:24,children:"heroicons-outline:adjustments-horizontal"}),s(K,{className:"text-2xl mb-3",color:"text.secondary",children:"Default Leave Form"})]}),i("div",{className:"m-10 p-10",children:[i(I,{fullWidth:!0,style:{marginBottom:"2rem"},children:[s(w,{id:"job-level-select-label",children:"Job Level"}),s(F,{labelId:"job-level-select-label",id:"job-level-select",value:l||"",label:"Job Level",onChange:R,children:n==null?void 0:n.map(e=>s(C,{value:e.id,children:e.jobLevel},e.id))})]}),r.map((e,a)=>i("div",{style:{display:"flex",alignItems:"center",marginBottom:"2rem",gap:"3rem"},children:[i(I,{fullWidth:!0,error:!e.name||g(e.name,a),children:[s(w,{id:`leave-type-select-label-${a}`,children:"Leave Type"}),s(F,{labelId:`leave-type-select-label-${a}`,id:`leave-type-select-${a}`,value:e.name,label:"Leave Type",onChange:t=>T(a,"name",t.target.value),children:f==null?void 0:f.map(t=>s(C,{value:t.name,children:t.name},t.id))}),!e.name&&s(S,{children:"Leave Type is required"}),g(e.name,a)&&s(S,{children:"This leave type is already selected"})]}),s(V,{label:"Total Leaves",type:"number",value:e.totalLeaves,onChange:t=>T(a,"totalLeaves",parseInt(t.target.value)),error:e.totalLeaves<=0,helperText:e.totalLeaves<=0?"Total Leaves must be greater than 0":"",style:{marginRight:"1rem"}}),s(p,{onClick:()=>k(a),variant:"outlined",color:"error",startIcon:s(X,{}),children:"Remove"})]},a))]}),s(p,{startIcon:s(Y,{}),onClick:M,disabled:!l,children:"Add Leave Type"}),i("div",{className:"flex justify-end mt-4 space-x-4",children:[b&&s(p,{variant:"outlined",color:"secondary",onClick:$,children:"Reset"}),s(p,{variant:"contained",color:"primary",onClick:N,disabled:!l||r.some(e=>!e.name||e.totalLeaves<=0)||r.some((e,a)=>g(e.name,a)),children:"Save"})]})]})})}export{te as default};
