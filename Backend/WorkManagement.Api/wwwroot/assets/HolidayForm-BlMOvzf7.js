import{a9 as U,r as m,ay as B,bl as K,bm as L,Q as I,a as i,j as t,y as C,M as v,an as x,ax as N,B as b,F as h,p as $,ab as w,T as Q,f as G,n as A,D as J}from"./index-Cf0SbAd0.js";function Z(){const{control:s,handleSubmit:O,reset:F,formState:{errors:l,touchedFields:H},setError:d,clearErrors:y,setValue:g}=U(),[c,V]=m.useState(new Date().getFullYear()),[o,u]=m.useState([]),[D,E]=m.useState(null),[M,f]=m.useState(!1),p=B(),{data:S,refetch:_}=K({year:c}),[z]=L();m.useEffect(()=>{u(S||[])},[S]);const T=e=>{const a=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-a)},Y=e=>{V(Number(e.target.value)),F(),f(!1)},j=e=>{const a=T(new Date(e.startDate)),n=T(new Date(e.endDate));if(a>n){d("startDate",{type:"manual",message:"Start date cannot be after end date"}),d("endDate",{type:"manual",message:"End date cannot be before start date"});return}if(o.some(r=>r.id!==(D==null?void 0:D.id)&&(new Date(r.startDate).toDateString()===a.toDateString()||new Date(r.endDate).toDateString()===n.toDateString()||a>=new Date(r.startDate)&&a<=new Date(r.endDate)||n>=new Date(r.startDate)&&n<=new Date(r.endDate)))){d("startDate",{type:"manual",message:"A holiday already exists on this date range"}),d("endDate",{type:"manual",message:"A holiday already exists on this date range"}),p(w({message:"Holiday already exists on this date range",autoHideDuration:6e3,anchorOrigin:{vertical:"top",horizontal:"center"},variant:"error"}));return}if(M&&D)u(o.map(r=>r.id===D.id?{...r,name:e.name,startDate:a.toISOString(),endDate:n.toISOString()}:r)),E(null),f(!1);else{const r={...e,startDate:a.toISOString(),endDate:n.toISOString()};u([...o,r])}F(),y()},q=async()=>{const e=o.map(({id:a,...n})=>({...n}));try{await z({body:e}),_(),p(w({message:"Holidays saved successfully",autoHideDuration:6e3,anchorOrigin:{vertical:"top",horizontal:"center"},variant:"success"}))}catch(a){console.error("Failed to save holidays:",a),p(w({message:"Failed to save holidays",autoHideDuration:6e3,anchorOrigin:{vertical:"top",horizontal:"center"},variant:"error"}))}},k=e=>{const a=o.find(n=>n.id===e);a&&(E(a),g("name",a.name),g("startDate",new Date(a.startDate.toString())),g("endDate",new Date(a.endDate.toString())),f(!0))},P=e=>{u(o.filter(a=>a.id!==e))},R=m.useMemo(()=>[{accessorKey:"name",header:"Holiday Name",accessorFn:e=>`${e.name}`},{accessorKey:"startDate",header:"Start Date",accessorFn:e=>I(new Date(e.startDate),"dd/MM/yyyy")},{accessorKey:"endDate",header:"End Date",accessorFn:e=>I(new Date(e.endDate),"dd/MM/yyyy")}],[]);return i($,{className:"p-24 max-w-5xl mx-auto",children:[i("div",{className:"flex items-center border-b-1 space-x-8 m-10",children:[t(h,{color:"action",size:24,children:"heroicons-outline:adjustments-horizontal"}),t(Q,{className:"text-2xl mb-3",color:"text.secondary",children:"Holiday Form"})]}),t("form",{onSubmit:O(j),children:i("div",{className:"flex flex-col gap-16 mb-24",children:[t("div",{className:"flex justify-start gap-16",children:t(C,{select:!0,label:"Year",value:c,onChange:Y,className:"w-1/4",children:[...Array(20)].map((e,a)=>t(v,{value:new Date().getFullYear()-3+a,children:new Date().getFullYear()-3+a},a))})}),i("div",{className:"flex gap-16",children:[t(x,{name:"name",control:s,rules:{required:"Holiday name is required"},render:({field:e})=>{var a;return t(C,{...e,variant:"outlined",value:e.value||"",label:"Holiday Name",error:H.name&&!!l.name,helperText:H.name&&((a=l.name)==null?void 0:a.message)})}}),t(x,{name:"startDate",control:s,rules:{required:"Start date is required",validate:e=>!e||!s._formValues.endDate||e<=s._formValues.endDate||"Start date cannot be after end date"},render:({field:e})=>{var a;return t(N,{format:"dd/MM/yyyy",...e,label:"Start Date",value:e.value||null,minDate:new Date(c,0,1),maxDate:new Date(c,11,31),slotProps:{textField:{error:!!l.startDate,helperText:(a=l.startDate)==null?void 0:a.message}},onChange:n=>{e.onChange(n),s._formValues.endDate&&n>s._formValues.endDate?d("endDate",{type:"manual",message:"End date cannot be before start date"}):y("endDate")}})}}),t(x,{name:"endDate",control:s,rules:{required:"End date is required",validate:e=>!e||!s._formValues.startDate||e>=s._formValues.startDate||"End date cannot be before start date"},render:({field:e})=>{var a;return t(N,{format:"dd/MM/yyyy",...e,label:"End Date",value:e.value||null,minDate:new Date(c,0,1),maxDate:new Date(c,11,31),slotProps:{textField:{error:!!l.endDate,helperText:(a=l.endDate)==null?void 0:a.message}},onChange:n=>{e.onChange(n),s._formValues.startDate&&n<s._formValues.startDate?d("startDate",{type:"manual",message:"Start date cannot be after end date"}):y("startDate")}})}}),M?t(b,{variant:"contained",type:"submit",startIcon:t(h,{children:"heroicons-outline:arrow-path"}),color:"info",children:"Update"}):t(b,{variant:"contained",type:"submit",startIcon:t(h,{children:"heroicons-outline:plus"}),color:"info",children:"Add"})]})]})}),t(J,{enableRowSelection:!1,data:o,columns:R,renderRowActionMenuItems:({closeMenu:e,row:a,table:n})=>[i(G,{children:[i(v,{onClick:()=>{P(a.original.id),e(),n.resetRowSelection()},children:[t(A,{children:t(h,{children:"heroicons-outline:trash"})}),"Remove"]},`remove-${a.original.id}`),i(v,{onClick:()=>{k(a.original.id),e(),n.resetRowSelection()},children:[t(A,{children:t(h,{children:"heroicons-outline:arrow-path"})}),"Update"]},`update-${a.original.id}`)]})]}),t(b,{variant:"contained",onClick:q,className:"mt-24",style:{backgroundColor:"#1976d2",color:"white"},children:"Save"})]})}export{Z as default};
